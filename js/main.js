const body=document.querySelector("body"),container=document.createElement("div"),h1=document.createElement("h1"),form=document.createElement("form"),input=document.createElement("input"),locationInput=document.createElement("input"),button=document.createElement("button"),reset=document.createElement("button"),search=document.createElement("i"),jobs=document.createElement("div"),linebreak=document.createElement("br"),results=document.createElement("div"),headline=document.createElement("p");container.className="container",h1.textContent="DevJobs",h1.className="display-1 fw-bold",headline.className="fs-2",headline.textContent="A job board aggregator for tech people.",search.className="fas fa-search",jobs.id="jobs",form.id="search-input",form.className="input-group mb-3",input.placeholder="Enter job title",input.type="text",input.className="form-control",locationInput.placeholder="Enter location",locationInput.type="text",locationInput.className="form-control",button.className="btn btn-primary btn-lg",button.id="search-button",button.type="submit",button.textContent="Search",reset.className="btn btn-secondary btn-lg",reset.id="reset-button",reset.type="reset",reset.textContent="Reset",body.appendChild(container),container.appendChild(h1),container.appendChild(headline),container.appendChild(form),form.appendChild(input),form.appendChild(locationInput),form.appendChild(button),form.appendChild(reset),container.appendChild(results),results.after(linebreak),container.appendChild(jobs);const endpoint="https://raw.githubusercontent.com/raaudain/devjobs/main/server/data/data.json",request=new XMLHttpRequest,jobsPerPage=30,postings=document.getElementById("jobs"),pagination=document.getElementById("pages");let data=[],filteredData=[],currentPage=1;request.open("GET","https://raw.githubusercontent.com/raaudain/devjobs/main/server/data/data.json"),request.onload=()=>{const a=JSON.parse(request.responseText);data=a,results.textContent=`Total jobs: ${a.length}`,renderLimit(a,jobsPerPage,currentPage)},request.onerror=()=>console.warn("Request error..."),request.send();function renderLimit(a,b,c){c--;let d=b*c,e=a.slice(d,d+b);renderJobs(e)}function renderJobs(a){a.map((a,b)=>{const c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("p"),f=document.createElement("h5"),g=document.createElement("h6"),h=document.createElement("h6"),i=document.createElement("a"),j=document.createElement("p"),k=document.createElement("a"),l=document.createElement("button");c.className="card border border-1 mb-5 shadow",c.id=`card_${b+1}`,c.style="width: 25rem",d.className="card-body d-flex flex-column justify-content-between",d.style="height: 100%",e.className="card-header",f.className="card-title",l.className="btn btn-primary btn-md",l.style="width: 100%;",g.className="card-subtitle mb-2 text-muted",h.className="card-subtitle mb-2 text-muted",i.className="url",j.className="fw-light text-muted",k.className="url text-decoration-none",i.href=a.url,i.target="_blank",i.rel="noopener noreferrer",k.href=a.source_url,k.target="_blank",k.rel="noopener noreferrer";const m=new Date(1e3*a.timestamp),n=m.getMonth(),o=m.getDate(),p=m.getDay(),q=m.getFullYear(),r=0===m.getHours()?"12":m.getHours(),s=2>`${m.getMinutes()}`.length?"0"+`${m.getMinutes()}`:m.getMinutes(),t=2>`${m.getSeconds()}`.length?"0"+`${m.getSeconds()}`:m.getSeconds(),u=12<r?`${r-12}:${s}:${t} PM`:`${r}:${s}:${t} AM`;e.textContent=`Posted: ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][p]} ${["January","February","March","April","May","June","July","August","September","October","November","December"][n]} ${o}, ${q}`,f.textContent=a.title,g.textContent=a.company,h.textContent=a.location,j.textContent=`Source: ${a.source}`,l.textContent="Apply",jobs.appendChild(c),c.appendChild(e),c.appendChild(d),d.appendChild(f),g&&d.appendChild(g),h&&d.appendChild(h),d.appendChild(k),i.appendChild(l),k.appendChild(j),d.appendChild(i)})}const searchBtn=document.getElementById("search-button"),resetBtn=document.getElementById("reset-button");window.addEventListener("scroll",()=>{const{scrollHeight:a,scrollTop:b,clientHeight:c}=document.documentElement;filteredData.length?b+c>a-100&&(currentPage++,setTimeout(renderLimit(filteredData,jobsPerPage,currentPage),2e3)):b+c>a-100&&(currentPage++,setTimeout(renderLimit(data,jobsPerPage,currentPage),2e3))}),window.addEventListener("load",()=>window.scrollTo(0,0)),searchBtn.addEventListener("click",a=>{a.preventDefault(),postings.innerHTML="",currentPage=1;const b=document.getElementById("search-input")[0].value.toLowerCase(),c=document.getElementById("search-input")[1].value.toLowerCase(),d=[];for(let e=0;e<data.length;){let a=data[e].title.toLowerCase(),f=data[e].location?data[e].location.toLowerCase():"";a.includes(b)&&f.includes(c)&&d.push(data[e]),e++}filteredData=d,results.textContent=filteredData.length===data.length?`Total jobs: ${d.length}`:`Results: ${d.length}`,renderLimit(d,jobsPerPage,currentPage)}),resetBtn.addEventListener("click",()=>location.reload());